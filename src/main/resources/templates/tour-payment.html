<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Citytours - Premium site template for city tours agencies, transfers and tickets.">
    <meta name="author" content="Ansonika">
    <title>CITY TOURS - City tours and travel site template by Ansonika</title>

    <!-- Favicons-->
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" type="image/x-icon" href="img/apple-touch-icon-57x57-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="72x72" href="img/apple-touch-icon-72x72-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="114x114" href="img/apple-touch-icon-114x114-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="144x144" href="img/apple-touch-icon-144x144-precomposed.png">

    <!-- GOOGLE WEB FONT -->
    <link href="https://fonts.googleapis.com/css?family=Gochi+Hand|Montserrat:300,400,700" rel="stylesheet">

    <!-- COMMON CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
	<link href="css/vendors.css" rel="stylesheet">
	
	<!-- CUSTOM CSS -->
	<link href="css/custom.css" rel="stylesheet">

</head>

<body>

	<div id="preloader">
		<div class="sk-spinner sk-spinner-wave">
			<div class="sk-rect1"></div>
			<div class="sk-rect2"></div>
			<div class="sk-rect3"></div>
			<div class="sk-rect4"></div>
			<div class="sk-rect5"></div>
		</div>
	</div>
	<!-- End Preload -->

	<div class="layer"></div>
	<!-- Mobile menu overlay mask -->

	<!--======================== Header========================== -->
	<div id="header" th:include="include-common-top::include-common-top"></div>
	<!--======================== End Header======================== -->

	<section id="hero_2">
		<div class="intro_title">
			<h1>Place your order</h1>
			<div class="bs-wizard row">

				<div class="col-4 bs-wizard-step complete">
					<div class="text-center bs-wizard-stepnum">Your cart</div>
					<div class="progress">
						<div class="progress-bar"></div>
					</div>
					<a href="cart_hotel.html" class="bs-wizard-dot"></a>
				</div>

				<div class="col-4 bs-wizard-step active">
					<div class="text-center bs-wizard-stepnum">Your details</div>
					<div class="progress">
						<div class="progress-bar"></div>
					</div>
					<a href="#" class="bs-wizard-dot"></a>
				</div>

				<div class="col-4 bs-wizard-step disabled">
					<div class="text-center bs-wizard-stepnum">Finish!</div>
					<div class="progress">
						<div class="progress-bar"></div>
					</div>
					<a href="confirmation_hotel.html" class="bs-wizard-dot"></a>
				</div>

			</div>
			<!-- End bs-wizard -->
		</div>
		<!-- End intro-title -->
	</section>
	<!-- End Section hero_2 -->
	
	<main>
		<div id="position">
			<div class="container">
				<ul>
					<li><a href="#">Home</a>
					</li>
					<li><a href="#">Category</a>
					</li>
					<li>Page active</li>
				</ul>
			</div>
		</div>
		<!-- End position -->

		<div class="container margin_60">
		<form name="rsPInfoF" method="POST" >
			<div class="row">
				<div class="col-lg-8 add_bottom_15">
					<div class="form_title">
						<h3><strong>1</strong>Tour Details</h3>
						<p>
							예약하신 투어 내용입니다.
						</p>
					</div>
					<div class="step">
						<div class="row">
							<div class="col-sm-12">
								<div class="form-group">
									<label> 여행명 </label>
									<input type="readonly" th:value="${session.payment.tour.toName}" class="form-control">
								</div>
							</div>
							<div class="col-sm-12">
								<div class="form-group">
									<label> 여행타입 </label>
									<input type="text" th:value="${session.payment.tour.toType}" class="form-control" >
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<div class="form-group">
									<label> 여행설명 </label>
									<input type="text" th:value="${#strings.substring(session.payment.tour.toInfo,0,3)}"class="form-control">
								</div>
							</div>
							<div class="col-sm-12">
								<div class="form-group">
									<label> 도시 </label>
									<input type="text" th:value="${session.payment.tour.city.cityName}"class="form-control">
								</div>
							</div>
						</div>
					</div>
					<div class="form_title">
						<h3><strong>1</strong>Your Details</h3>
						<p>
							Mussum ipsum cacilds, vidis litro abertis.
						</p>
					</div>
					
					<div class="step">
						<div class="row">
							<div class="col-sm-8">
								<div class="form-group">
									<label> 이름 </label>
									<input type="text" class="form-control" name="rsPName">
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<label> 이메일 </label>
									<input type="email" id="email_booking" name="rsPEmail" class="form-control">
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label>Confirm email</label>
									<input type="email" id="email_booking_2" name="email_booking_2" class="form-control">
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<label>Telephone</label>
									<input type="text" id="telephone_booking" name="rsPPhone" class="form-control">
								</div>
							</div>
						</div>
					</div>
					</form>
					<!--End step -->
					
					<div class="form_title">
						<h3><strong>2</strong> 예약 특이사항 </h3>
						<p>
							예약시 특이사항을 적어주세요
						</p>
					</div>
					<div class="step">
						<div class="row">
							<div class="col-lg-12">
								<div class="form-group">
									<label>특이사항 </label>
									<input type="text" id="city_booking" name="pMsg" class="form-control">
								</div>
							</div>
						</div>
						<!--End row -->
					</div>
					<!--End step -->

					<div class="form_title">
						<h3><strong>3</strong>Payment Information</h3>
						<p>
							Mussum ipsum cacilds, vidis litro abertis.
						</p>
					</div>
					<div class="step">
						<div class="form-group">
							<select class="form-control" name="pMethod" id="pMethod" required>
								<option value="" selected disabled hidden>결제방법</option>
								<option value="1">계좌이체</option>
								<option value="2">카카오페이</option>
								<option value="3">카드결제</option>
							</select>
						</div>
							
					</div>
						<!--End row -->
					</div>
					<!--End step -->

				
			</form>
			
				<aside class="col-lg-4">
					<div class="box_style_1">
						<h3 class="inner">- Summary -</h3>
						<table class="table table_summary">
							<tbody>
								<tr>
									<td>
										여행 시작일
									</td>
									<td class="text-right" th:text="${session.payment.pStartDate}">
									</td>
								</tr>
								<tr>
									<td>
										여행 종료
									</td>
									<td class="text-right" th:text="${session.payment.pStartDate}">
										10 April 2015
									</td>
								</tr>
								<tr>
									<td>
										여행일수
									</td>
									<td class="text-right" th:text="${session.payment.tour.toTime}">
										1 double room
									</td>
								</tr>
								<tr>
									<td>
										여행타입
									</td>
									<td class="text-right" th:text="${session.payment.tour.toType}">
										2
									</td>
								</tr>
								<tr>
									<td>
										금액
									</td>
									<td class="text-right" th:text="${session.payment.tour.toPrice}">
										2
									</td>
								</tr>
								<tr>
									<td>
										예약 인원 수 
									</td>
									<td class="text-right" th:text="${session.payment.pQty}">
										0
									</td>
								</tr>
								<tr class="total">
									<td>
										총 금액
									</td>
									<td class="text-right" th:text="${session.payment.pPrice}">
										$154
									</td>
								</tr>
							</tbody>
						</table>
						<button class="btn_full" type="button" id="tourPayment" onclick="tourPaymentAction()">Book now</button>
						<a class="btn_full_outline" href="single_hotel.html"><i class="icon-right"></i> Modify your search</a>
					</div>
					<div class="box_style_4">
						<i class="icon_set_1_icon-57"></i>
						<h4>Need <span>Help?</span></h4>
						<a href="tel://004542344599" class="phone">+45 423 445 99</a>
						<small>Monday to Friday 9.00am - 7.30pm</small>
					</div>
				</aside>
			</div>
			<!--End row -->
								<div id="policy">
						<h4>Cancellation policy</h4>
						<div class="form-group">
							<label>
								<input type="checkbox" name="policy_terms" id="policy_terms">I accept terms and conditions and general policy.
							</label>
						</div>
					</div>
		</div>
		<!--End container -->
	</main>
	<!-- End main -->
	<!--========================= footer ========================-->
	<footer class="revealed">
		<div id="footer" th:include="include-common-bottom::include-common-bottom"></div>
	</footer>
		<!-- End container -->
	<!--========================= End footer ========================-->
	<div id="toTop"></div><!-- Back to top button -->
	
	<!-- Search Menu -->
	<div class="search-overlay-menu">
		<span class="search-overlay-close"><i class="icon_set_1_icon-77"></i></span>
		<form role="search" id="searchform" method="get">
			<input value="" name="q" type="search" placeholder="Search..." />
			<button type="submit"><i class="icon_set_1_icon-78"></i>
			</button>
		</form>
	</div><!-- End Search Menu -->
	

	<!-- Common scripts -->
	<script src="js/jquery-2.2.4.min.js"></script>
	<script src="js/common_scripts_min.js"></script>
	<script src="js/functions.js"></script>
	<script src="js/app_tour.js" type="module"></script>
	<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
	
	<!-- Check box and radio style iCheck -->
	<script>
		$('input').iCheck({
		   checkboxClass: 'icheckbox_square-grey',
		   radioClass: 'iradio_square-grey'
		 });
	</script>
	<script type="text/javascript">
		function tourPaymentAction(e){

			let IMP = window.IMP; // 생략 가능
			IMP.init("imp43548145"); // 예: imp00000000a
			
			let pMethod;
			if('#pMethod'.val==3){
				pMethod='card';
			}
			/********** 자바스크립트에서 세션 값 가져오는거 먼저 해야 함!!  ***** */
		    IMP.request_pay({
		      pg: "html5_inicis",
		      pay_method: pMethod,
		      merchant_uid: 'MRK_'+new Date().getTime(),   // 주문번호 -> insert 전이라서 번호가 0번으로 생성됨,,, 개짱난다
		      name: "[[${session.tour.toName}]]",
		      //amount: "[[${{session.payment.pPrice}}]]",                         // 숫자 타입
		      amount: 100,                        // 숫자 타입
		      buyer_email: "[[${session.loginUser.email}]]",
		      buyer_name: "[[${session.loginUser.name}]]",
		      buyer_tel: "[[${session.loginUser.phone}]]",
		      buyer_addr: "[[${session.loginUser.address}]]"
		    }, function (rsp) { // callback
		    	console.log(rsp);
		      	if (rsp.success) {
		        // 결제 성공 시 로직
					document.rsPInfoF.action='tour-payment-action';
					document.rsPInfoF.submit();
		      	} else {
		        // 결제 실패 시 로직
		        	console.log(rsp);
		      	}
				});
			}
	</script>


</body>

</html>