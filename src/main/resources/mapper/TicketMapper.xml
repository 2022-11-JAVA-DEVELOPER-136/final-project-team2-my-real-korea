<?xml version="1.0" encoding="UTF-8"?>
		<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwill.my_real_korea.mapper.TicketMapper">

	<resultMap id="ticketMap" type="com.itwill.my_real_korea.dto.ticket.Ticket" autoMapping="true">
		<!--ticketImage List-->
		<association property="city"
					 javaType="com.itwill.my_real_korea.dto.City"
					 column="city_no"
					 select= "com.itwill.my_real_korea.mapper.CityMapper.selectByCityNo">
		</association>
		<collection property="ticketImgList" javaType="java.util.List"
					ofType="com.itwill.my_real_korea.dto.ticket.TicketImg"
					autoMapping="true">
		</collection>
	</resultMap>
	<!-- 티켓 생성 -->
	<insert id="insertTicket" parameterType="com.itwill.my_real_korea.dto.ticket.Ticket">
		<selectKey resultType="java.lang.Integer" keyProperty="tiNo" order="BEFORE">
                SELECT TICKET_TI_NO_SEQ.nextval FROM DUAL
		</selectKey>
            INSERT INTO TICKET (TI_NO, TI_TITLE, TI_DATE, TI_PRICE, TI_INFO, TI_NOTICE, TI_COUNT, CITY_NO)
            VALUES (#{tiNo},#{tiTitle},SYSDATE,#{tiPrice},#{tiInfo},#{tiNotice},#{tiCount},#{city.cityNo})
        </insert>

	<!-- 전체 티켓 상품 보기 -->
	<select id="selectAll" resultType="com.itwill.my_real_korea.dto.ticket.Ticket">
				SELECT * FROM TICKET
      </select>
	<!-- 상품 상세보기
<select id="selectByTicketNo"  parameterType="java.lang.Integer" resultType="com.itwill.my_real_korea.dto.ticket.Ticket">
    SELECT * FROM TICKET WHERE TI_NO=#{tiNo} </select> -->

	<!-- 상품 상세보기 - 지역 + 사진  collection?-->
	<select id="selectByTicketNoCity" parameterType="java.lang.Integer" resultMap="ticketMap">
					SELECT *
					FROM TICKET T
							 JOIN TICKET_IMG TI
								  ON T.TI_NO = TI.TI_NO
							 JOIN CITY C
								  ON T.CITY_NO = C.CITY_NO
				WHERE T.TI_NO=#{tiNo}
			</select>
		<!-- 상품 지역별 검색 -->
			<select id="selectByTicketCity" parameterType="java.lang.Integer" resultType="com.itwill.my_real_korea.dto.ticket.Ticket">
					SELECT * FROM TICKET WHERE CITY_NO=#{city.cityNo}
			</select>
		<!-- 상품 키워드로 검색 -->
			<select id="selectByKeywordTicket" parameterType="java.lang.String" resultType="com.itwill.my_real_korea.dto.ticket.Ticket">
				   SELECT * FROM TICKET WHERE TI_TITLE LIKE '%'||#{keyword}||'%'
 			</select>
        <!-- 상품 가격 순으로 검색 -->
            <select id="selectByTicketPrice" parameterType="java.lang.String" resultType="com.itwill.my_real_korea.dto.ticket.Ticket">
            	  SELECT * FROM TICKET ORDER BY TI_PRICE ${sortOrder}
				<trim prefix="ORDER BY">
					<if test="sortOrder == 'asc'"/>
					<if test="sortOrder == 'desc'"/>
				</trim>
			</select>
    	<!-- 상품 번호로 수정 -->
	        <update id ="updateTicket" parameterType="com.itwill.my_real_korea.dto.ticket.Ticket">
	            UPDATE TICKET SET TI_TITLE=#{tiTitle}, TI_PRICE=#{tiPrice}, TI_INFO={tiInfo}, TI_NOTICE={tiNotice},
	                              TI_COUNT=#{tiCount}, CITY_NO={#cityNo}
	            WHERE TI_NO=#{TI_NO}
	        </update>
		<!-- 상품 1개 삭제-->
	        <delete id="deleteTicket" parameterType="java.lang.Integer">
	            DELETE FROM TICKET WHERE TI_NO=#{tiNo}
	        </delete>
</mapper>